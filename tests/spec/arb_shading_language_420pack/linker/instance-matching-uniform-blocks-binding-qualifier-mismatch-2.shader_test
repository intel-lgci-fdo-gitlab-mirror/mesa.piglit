/* This test is designed to trigger a mesa optimisation where the uniform
 * block from the vertex shader is moved to the fragment shader. Here we
 * test that the optimisation doesn't mistake the two blocks as the same
 * due to the matching instance name.
 *
 * GLSLangSpec.1.50.11, 4.3.7 Interface Blocks:
 * "The block name (block-name) is used to match interfaces: an output
 *  block of one pipeline stage will be matched to an input block with
 *  the same name in the subsequent pipeline stage. For uniform blocks,
 *  the application uses the block name to identify the block.
 *
 *  ...
 *
 *  Outside the shading language (i.e., in the API), members are
 *  similarly identified except the block name is always used in place
 *  of the instance name (API accesses are to interfaces, not to
 *  shaders)."
 */

[require]
GLSL >= 1.50
GL_ARB_shading_language_420pack

[vertex shader]
#version 150
#extension GL_ARB_shading_language_420pack: require

layout(binding = 0) uniform blockA {
	vec2 a;
	vec2 b;
} inst;

out vec4 fragColour;

void main()
{
	gl_Position = vec4(1.0);
	fragColour = vec4(inst.a, inst.b);
}

[fragment shader]
#version 150
#extension GL_ARB_shading_language_420pack: require

layout(binding = 1) uniform blockB {
	vec4 a;
} inst;

in vec4 fragColour;
out vec4 color;

void main()
{
	color = inst.a + fragColour;
}

[test]
link success
